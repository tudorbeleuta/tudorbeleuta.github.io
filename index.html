<html>
	<head>
		<link rel="stylesheet" href="res/libs/leaflet2.css" />
		<script src="res/libs/jquery.min.js"></script>
		<script src="res/libs/leaflet2.js"></script>
		<script src="res/libs/skobbler-2.0.js"></script>


		<script src="res/data/edge_repo.js"></script>

  </head>
  <body>
		<style>
		    #map {
			height: 97%;
		    }
		</style>

		<div id="map"></div>

    <script>

    var map;

  	var statColorMap={
  				"safe":"#1b9e77",
          "touristy":"#7570b3",
    			"recreational": "#66a61e",
          "fast" : "#d95f02",
          "challenging" : "#d95f02",
          "crowded" : "#e6ab02"
  	}



    function constructMap(mapCenter){


          var clujCenter=[46.7667, 23.58333];
          var bucharestCenter=[44.439663,26.096306];

          map = L.skobbler.map('map', {
          apiKey: '3734af6c762c6ca5d8ad704b6bb1fe3b',
          mapStyle: 'bike',
          bicycleLanes: true,
          onewayArrows: true,
          pois: 'all',
          primaryLanguage: 'en',
          fallbackLanguage: 'en',
          mapLabels: 'localNaming',
          retinaDisplay: 'auto',

          zoomControl: true,
          zoomControlPosition: 'top-left',

          center: clujCenter,
          zoom: 13
      });


    }


    	function drawTraversedEdges(edgeArray,maxEdgeTraversals){

    		edgeArray.forEach(function(edge) {
    			var base = new L.LatLng(edge.coords.baseLat,edge.coords.baseLon);
    			var adj = new L.LatLng(edge.coords.adjLat,edge.coords.adjLon);
    			var pointList=[base,adj];
    			//TODO: find global maximum edge traversals from graph
    			var width=3*(0.6+edge.total/maxEdgeTraversals);
    			new L.Polyline(pointList, {
    				color: statColorMap[edge.dominant],
    				weight: width,
    				opacity: 1,
    				smoothFactor: 3

    			}).addTo(map);

    		});
    	}

      function init(){
    		constructMap("cluj");
    		drawTraversedEdges(mapList.data,mapList.maxEdgeTraversals);
    	}
    	init();

    	</script>

    	</body>



</html>

